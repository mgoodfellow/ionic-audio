function ionAudioTrack(n,i){function o(o,t){var r=this,a=(t.find("ion-audio-progress-bar").length>0,function(){o._track.progress=0,o._track.status=0,o._track.duration=-1,n&&(o._track.id=n.add(o._track,e,null,u,s))}),e=function(){o._track.status=0,o._track.progress=0},u=function(n){o._track.status=n},s=function(n,i){o.$apply(function(){o._track.progress=n,o._track.duration=i})},c=function(){i.$broadcast("ionic-audio:trackChange",o._track)};this.seekTo=function(i){n.seekTo(i)},this.getTrack=function(){return o._track},o._track.play=function(){return n?(n.play(o._track.id),r.hasOwnProgressBar||c(),o._track.id):void 0},o.$on("$destroy",function(){n.destroy()}),a()}return{transclude:!0,template:"<ng-transclude></ng-transclude>",restrict:"E",scope:{_track:"=track"},controller:["$scope","$element",o]}}function ionAudioProgress(){return{restrict:"E",scope:{_track:"=track"},template:"{{_track.progress | time}}"}}function ionAudioProgressBar(n){function i(i,o,t){function r(){i._track.progress=0,i._track.status=0,i._track.duration=-1}i=i._track?i:i.$parent;var a,e=o.find("input");angular.isDefined(t.displayTime)||(o.find("ion-audio-progress").remove(),o.find("ion-audio-duration").remove()),angular.isDefined(t.displayInfo)||o.find("h2").remove(),angular.isUndefined(i._track)&&(i._track={},a=i.$on("ionic-audio:trackChange",function(n,o){i._track=o}));var u=i.$watch("_track.status",function(n){e.prop("disabled",0==n)});i.displayTrackInfo=function(){return{visibility:angular.isDefined(t.displayInfo)&&(i._track.title||i._track.artist)?"visible":"hidden"}},i.sliderRelease=function(){var o=i._track.progress;n.seekTo(o)},i.$on("$destroy",function(){u(),angular.isDefined(a)&&a()}),r()}return{restrict:"E",template:'<h2 class="ion-audio-track-info" ng-style="displayTrackInfo()">{{_track.title}} - {{_track.artist}}</h2><div class="range"><ion-audio-progress track="_track"></ion-audio-progress><input type="range" name="volume" min="0" max="{{_track.duration}}" ng-model="_track.progress" on-release="sliderRelease()" disabled><ion-audio-duration track="_track"></ion-audio-duration></div>',link:i}}function ionAudioPlay(n){function i(i,o,t,r){i=i._track?i:i.$parent;var a,e,u=0,s=function(){a=!1,o.addClass("ion-play"),o.removeClass("ion-pause"),o.text(t.textPlay)},c=function(){t.textPlay&&t.textPause&&o.text(o.text()==t.textPlay?t.textPause:t.textPlay)},d=function(){o.toggleClass("ion-play ion-pause"),c()};n.on("tap",function(){return e||a?void(e=!1):(0==u&&(a=!0),r.play(),void d())},o),n.on("doubletap",function(){e=!0},o);var l=i.$watch("_track.status",function(n){0==n||4==n?s():2==n&&(a=!1),u=n});s(),i.$on("$destroy",function(){l()})}return{restrict:"A",require:"^^ionAudioControls",link:i}}function ionAudioDuration(){return{restrict:"E",scope:{_track:"=track"},template:"{{_track.duration | duration}}"}}angular.module("ionic-audio",["ionic"]),angular.module("ionic-audio").filter("time",function(){var n=function(n){return(new Array(2).join("0")+n).slice(-2)};return function(i){i=i||0;var o=parseInt(i);return n(Math.floor(o/60))+":"+n(o%60)}}),angular.module("ionic-audio").filter("duration",["$filter",function(n){return function(i){return i>0?n("time")(i):""}}]),angular.module("ionic-audio").factory("MediaManager",["$q","$interval","$timeout","$window",function(n,i,o,t){function r(n){h=n,console.log("ionic-audio: playing track "+h.title),e(h).then(function(n){_=n,_.play(),g()},function(n){console.log("ionic-audio: failed to create media - "+n)})}function a(){console.log("ionic-audio: resuming track "+h.title),_.play(),g()}function e(i){var o=n.defer();return i.url?"function"==typeof i.url?i.url().then(function(n){i.url=n,o.resolve(new Media(n,angular.bind(i,s),angular.bind(i,c),angular.bind(i,d)))},function(n){o.reject(n)}):"string"==typeof i.url?o.resolve(new Media(i.url,angular.bind(i,s),angular.bind(i,c),angular.bind(i,d))):(console.log("ionic-audio: unrecognised track url type"),o.reject("missing track url")):(console.log("ionic-audio: missing track url"),o.reject("missing track url")),o.promise}function u(){angular.isDefined(_)&&(_.release(),_=void 0,h=void 0)}function s(){l(),u(),angular.isFunction(this.onSuccess)&&this.onSuccess()}function c(){angular.isFunction(this.onError)&&this.onError()}function d(n){this.status=n,angular.isFunction(this.onStatusChange)&&this.onStatusChange(n)}function l(){angular.isDefined(b)&&(i.cancel(b),b=void 0)}function g(){angular.isDefined(b)||h&&(b=i(function(){h.duration<0&&(h.duration=_.getDuration()),_.getCurrentPosition(function(n){n>-1&&(h.progress=n)},function(n){console.log("Error getting pos="+n)}),angular.isFunction(h.onProgress)&&h.onProgress(h.progress,h.duration)},1e3))}function f(n,i,o,t,r){return n.url?(angular.extend(n,{onSuccess:i,onError:o,onStatusChange:t,onProgress:r,status:0,duration:-1,progress:0}),n.id=$.push(n)-1,n.id):void console.log("ionic-audio: missing track url")}function p(n){if(h){if(h.id==n)return void(h.status==Media.MEDIA_RUNNING?k():a());h.id>-1&&v()}o(function(){r($[n])},300)}function k(){console.log("ionic-audio: pausing track "+h.title),_.pause(),l()}function v(){_&&(console.log("ionic-audio: stopping track "+h.title),_.stop())}function y(n){_&&_.seekTo(1e3*n)}function m(){l(),u()}function r(n){h=n,console.log("ionic-audio: playing track "+h.title),e(h).then(function(n){_=n,_.play(),g()},function(n){console.log("ionic-audio: failed to create media - "+n)})}function a(){console.log("ionic-audio: resuming track "+h.title),_.play(),g()}function e(i){var o=n.defer();if(i.url)if("function"==typeof i.url)i.url().then(function(n){i.url=n;var t=new buzz.sound(n);t.bind("loadstart",angular.bind(i,d,1)).bind("playing",angular.bind(i,d,2)).bind("pause",angular.bind(i,d,3)).bind("error",c),o.resolve(t)},function(n){o.reject(n)});else if("string"==typeof i.url){var t=new buzz.sound(i.url);t.bind("loadstart",angular.bind(i,d,1)).bind("playing",angular.bind(i,d,2)).bind("pause",angular.bind(i,d,3)).bind("error",c),o.resolve(t)}else console.log("ionic-audio: unrecognised track url type"),o.reject("missing track url");else console.log("ionic-audio: missing track url"),o.reject("missing track url");return o.promise}function u(){angular.isDefined(_)&&(_.unbind("loadstart loadeddata playing pause progress durationchange timeupdate error"),_=void 0,h=void 0)}function c(){angular.isFunction(this.onError)&&this.onError()}function d(n){this.status=n,angular.isFunction(this.onStatusChange)&&this.onStatusChange(n)}function l(){angular.isDefined(b)&&(i.cancel(b),b=void 0)}function g(){angular.isDefined(b)||h&&(b=i(function(){h.duration<0&&(h.duration=_.getDuration()),h.progress=_.getTime(),angular.isFunction(h.onProgress)&&h.onProgress(h.progress,h.duration)},1e3))}function f(n,i,o,t,r){return n.url?(angular.extend(n,{onSuccess:i,onError:o,onStatusChange:t,onProgress:r,status:0,duration:-1,progress:0}),n.id=$.push(n)-1,n.id):void console.log("ionic-audio: missing track url")}function p(n){if(h){if(h.id==n)return void(2==h.status?k():a());h.id>-1&&v()}o(function(){r($[n])},300)}function k(){console.log("ionic-audio: pausing track "+h.title),_.pause(),l()}function v(){_&&(console.log("ionic-audio: stopping track "+h.title),_.pause(),l())}function y(n){_&&_.setTime(n)}function m(){l(),u()}var h,_,b,$=[];return t.cordova&&t.Media?{add:f,play:p,pause:k,stop:v,seekTo:y,destroy:m}:buzz?{add:f,play:p,pause:k,stop:v,seekTo:y,destroy:m}:(console.log("ionic-audio: missing Cordova Media plugin. Have you installed the plugin? \nRun 'ionic plugin add org.apache.cordova.media'"),null)}]),angular.module("ionic-audio").directive("ionAudioTrack",["MediaManager","$rootScope",ionAudioTrack]),angular.module("ionic-audio").directive("ionAudioProgress",ionAudioProgress),angular.module("ionic-audio").directive("ionAudioProgressBar",["MediaManager",ionAudioProgressBar]),angular.module("ionic-audio").directive("ionAudioPlay",["$ionicGesture",ionAudioPlay]),angular.module("ionic-audio").directive("ionAudioDuration",ionAudioDuration),angular.module("ionic-audio").directive("ionAudioControls",function(){function n(n,i){n=n._track?n:n.$parent;var o,t=i.find("ion-spinner"),r=this;t.addClass("ng-hide"),this.toggleSpinner=function(){t.toggleClass("ng-hide")},this.play=function(){o||r.toggleSpinner(),n._track.play()};var a=n.$watch("_track.status",function(n){switch(n){case 1:o=!1;break;case 2:o||(r.toggleSpinner(),o=!0);break;case 0:case 4:o=!1}});n.$on("$destroy",function(){a()})}return{restrict:"EA",controller:["$scope","$element",n]}});